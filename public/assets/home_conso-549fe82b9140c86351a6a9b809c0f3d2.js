jQuery(document).ready(function(t){function a(a,e,h,n,i,o,l){if(1==o){var r=t('<canvas width="'+2.5*e+'px" height="'+2.5*e+'px" />');a.append(r);var s=r[0].getContext("2d")}else s=o;if(s.beginPath(),s.translate(1.25*e,1.25*e),l){var c=h/3,M=h/100,d=s.createLinearGradient(-e/100*80*Math.cos(n-Math.PI/2),-e/100*80*Math.sin(n-Math.PI/2),-e/100*80*Math.cos(n+c+M-Math.PI/2),-e/100*80*Math.sin(n+c+M-Math.PI/2));d.addColorStop("0","white"),d.addColorStop("1","#EA9035"),s.arc(0,0,e/100*85,n+Math.PI/2,n+c+M+Math.PI/2,!1),s.lineWidth=e/100*20,s.strokeStyle=d,s.stroke(),s.save(),s.beginPath(),d=s.createLinearGradient(-e/100*80*Math.cos(n+c-Math.PI/2),-e/100*80*Math.sin(n+c-Math.PI/2),-e/100*80*Math.cos(n+2*c+M-Math.PI/2),-e/100*80*Math.sin(n+2*c+M-Math.PI/2)),d.addColorStop("0","#EA9035"),d.addColorStop("1","#BF400A"),s.arc(0,0,e/100*85,n+c+Math.PI/2,n+2*c+M+Math.PI/2,!1),s.lineWidth=e/100*20,s.strokeStyle=d,s.stroke(),s.save(),s.beginPath(),d=s.createLinearGradient(-e/100*80*Math.cos(n+2*c-Math.PI/2),-e/100*80*Math.sin(n+2*c-Math.PI/2),-e/100*80*Math.cos(n+h-Math.PI/2),-e/100*80*Math.sin(n+h-Math.PI/2)),d.addColorStop("0","#BF400A"),d.addColorStop("1","red"),s.arc(0,0,e/100*85,n+2*c+Math.PI/2,n+h+Math.PI/2,!1),s.lineWidth=e/100*20,s.strokeStyle=d,s.stroke(),s.save()}else s.strokeStyle="#303030",s.arc(0,0,e/100*85,n+Math.PI/2,h+n+Math.PI/2,!1),s.lineWidth=e/100*20;return i&&(s.shadowOffsetX=e/100*1.5,s.shadowBlur=e/100*8,s.shadowColor="rgba(0,0,0,0.5)"),s.stroke(),s}function e(a,e,h,n,i,o,l){if(1==l){var r=t('<canvas width="'+2.5*e+'px" height="'+2.5*e+'px" />');a.append(r);var s=r[0].getContext("2d")}else s=l;return s.translate(1.25*e,1.25*e),s.beginPath(),s.strokeStyle=o,s.lineWidth=4,s.moveTo(-e/100*73*Math.cos(i-Math.PI/2),-e/100*73*Math.sin(i-Math.PI/2)),s.lineTo(-e/100*97*Math.cos(i-Math.PI/2),-e/100*97*Math.sin(i-Math.PI/2)),s.stroke(),s}function h(a,e,h,n){if(h===!0){var i=t('<canvas width="'+2.5*e+'px" height="'+2.5*e+'px" />');a.append(i);var o=i[0].getContext("2d");o.translate(1.25*e,1.25*e)}else o=h;return o.beginPath(),o.fillStyle="#33cc00",o.font="20pt helvetica_neuelight",o.textAlign="center",n?o.fillText("\u20ac",0,40):o.fillText("Wh",0,40),o.save(),o}function n(a,e,h,n,i,o,l,r,s,c,M,d,P){if(1==P){var p=t('<canvas width="'+2.5*e+'px" height="'+2.5*e+'px" />');a.append(p);var I=p[0].getContext("2d")}else I=P;I.beginPath(),I.translate(1.25*e,1.25*e),I.save(),I.beginPath(),I.fillStyle="blue",I.font="8pt helvetica_neuelight",I.textAlign=l==i?"right":"center",I.fillText(l,-e/100*110*Math.cos(n-Math.PI/2),-e/100*110*Math.sin(n-Math.PI/2)),I.save(),I.beginPath(),I.fillStyle="red",I.font="8pt helvetica_neuelight",I.textAlign=r==o?"left":"center",I.fillText(r,-e/100*110*Math.cos(n+h-Math.PI/2),-e/100*110*Math.sin(n+h-Math.PI/2)),I.save(),I.beginPath(),I.fillStyle="orange",I.font="8pt helvetica_neuelight",I.textAlign="center",I.fillText(s,-e/100*110*Math.cos(M-Math.PI/2),-e/100*110*Math.sin(M-Math.PI/2)),I.stroke()}t("input.conso").wrap('<div class="conso" />').each(function(){var i=t(this),o=i.parent(),l=i.data("min"),r=i.data("max"),s=i.data("cur")?i.data("cur"):l,c=i.data("cum"),M=Math.min(30,l),d=Math.max(500,r),P=(i.data("color")?i.data("color"):"#33cc00",i.data("taille")?i.data("taille"):100),p=!1,I=Math.round(14e-5*c*100)/100,f=2*Math.PI*(r-l)/(d-M),v=2*Math.PI*(l-M)/(d-M),g=2*Math.PI*(s-M)/(d-M),u=2*Math.PI*(c-M)/(d-M);o.width(2.5*P).height(2.5*P),i.width(130).css("font-size",P/100*40+"px").css("top",P/100*90+"px").css("left",P/100*60+"px").css("text-align","center").css("color","#33cc00"),a(o,P,2*Math.PI-f,v+f,!0,!0,!1),a(o,P,f,v,!1,!0,!0),e(o,P,f,v,g,"orange",!0),n(o,P,f,v,M,d,l,r,s,c,g,u,!0);var x=h(o,P,!0,p);o.mousedown(function(t){t.preventDefault(),0==p?(p=!0,i.val(I)):(p=!1,i.val(c)),x.clearRect(-20,0,50,50),h(o,P,x,p)}).mouseup(function(t){t.preventDefault()})})});